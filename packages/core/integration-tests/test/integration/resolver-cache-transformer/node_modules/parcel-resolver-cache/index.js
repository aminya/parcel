// @flow
const { Resolver } = require("@parcel/plugin");
const path = require("path");

module.exports = new Resolver({
  async resolve({ dependency, options }) {
    let { inputFS: fs, projectRoot } = options;
    if (dependency.sourcePath != null) {
      let prefix = path.resolve(
        path.dirname(dependency.sourcePath),
        dependency.moduleSpecifier
      );
      if (await fs.exists(prefix + ".a")) {
        return {
          filePath: prefix + ".a",
        };
      } else if (await fs.exists(prefix + ".b")) {
        return {
          filePath: prefix + ".b",
          filesCreation: new Set([prefix + ".a"]),
        };
      }
    } else {
      return {
        filePath: dependency.moduleSpecifier,
      };
    }
  },
});
